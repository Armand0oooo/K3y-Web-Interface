(function(){Interface.main={init:function(){var d=Interface.data.type,a=document.getElementsByTagName("head")[0],c=document.createElement("link"),b=document.createElement("link"),e=document.getElementById("dynamic-favicon"),f=d.toUpperCase()+" Web Interface";c.type="text/css";c.rel="stylesheet";c.href="js/k3y.css."+d+".css";c.media="screen";a.appendChild(c);b.id="dynamic-favicon";b.rel="shortcut icon";b.href="img/icon-"+d+".ico";if(e){a.removeChild(e)}a.appendChild(b);if(Interface.data.storage.settings.get("doublewidth")){$(".page").addClass("page-double")}$(".logo > img").attr("src","img/logo-"+d+".png");$("title").html(f);if(navigator.userAgent=="Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0; Xbox)"){Interface.utils.messageBox.create(Interface.data.messages["notify-xbox"])}},create:{gamepage:function(k,f){var h=k[1].split("&"),a=h[1],c=h[0],l="covers/"+c+".xml",j=$("#game-page"),n,b,i,d="",p,m,o,e=Interface.utils.getGame(c),g;j.find("#game-title").html("Loading "+unescape(a));j.find(".page-content").html("Loading info...");if(!f){$.ajax({type:"GET",url:l,success:function(r){var q=$(r);Interface.main.create.gamepage(k,q)},error:function(){$.ajax({type:"GET",url:"img/empty.xml",success:function(r){var q=$(r);Interface.main.create.gamepage(k,q)}})}})}else{n=f.find("title").text();i=f.find("summary").text();p="covers/"+c+".jpg";m="<table>";if(n=="No Title"){n=unescape(a)}m+="<tr><td>HDD: </td><td>"+e.hdd+"</td></tr>";f.find("infoitem").each(function(){m+="<tr>";o=$(this);g=o.text();if(g.indexOf("www")==0||g.indexOf("http")==0){if(g.indexOf("youtube.com")!=-1){var q=Interface.utils.parseYouTubeURL(g);if(q!=""){g='<a href="javascript:void(0);" onclick="Interface.utils.videoPopup(\''+q+"')\">"+g+"</a>"}else{g='<a href="'+g+'" target="_blank">'+g+"</a>"}}else{g='<a href="'+g+'" target="_blank">'+g+"</a>"}}m+="<td>"+o.attr("name")+": </td><td>"+g+"</td>";m+="</tr>"});m+="</table><br/>";d+='<div class="gamepage-info">';d+=m;d+="</div>";d+='<div class="main-item gamepage-item active-game">';d+='<img class="gamepage-game" src="'+p+'" alt="Cover"/></div>';d+="<div>";d+=i;d+="</div>";d+="<br/>";d+='<div class="gamepage-buttonContainer">';d+='<a href="javascript:void(0)" onclick="Interface.utils.launch(\''+c+'\')"><span class="prettyButton">Play</span></a>';d+='<a href="#favorites_game_manager-page?'+c+"&"+escape(a)+'"><span class="prettyButton">Manage lists</span></a>';d+="</div>";d+='<br class="clear"/>';if(Interface.data.storage.settings.get("gamenavigation")){b="<a onclick=\"Interface.utils.selectPrev('"+c+'\')" href="javascript:void(0)"><img alt="Previous" src="img/back.png" class="nav-button-prev"></a>';b+='<span class="game-title-text">'+n+"</span>";b+="<a onclick=\"Interface.utils.selectNext('"+c+'\')" href="javascript:void(0)"><img alt="Previous" src="img/next.png" class="nav-button-next"></a>'}else{b='<span class="game-title-text">'+n+"</span>"}j.find("#game-title").html(b);j.find(".page-content").html(d)}},coverwall:function(c,q){var a,b,p,o,n=document.getElementById("coverColumnsSelect").value,h="",f=Interface.data.data.sorted,e=Interface.data.data.active,m=Interface.data.storage.settings.get("coverwalltitle"),k=Interface.data.data.storage.vars.coverwallColumns,d,j,g="";if((c&&q)&&q.length>0){if(q.length>0){f=Interface.utils.search(q);n="search"}else{if(q.length==0){n="alphabetic"}}}if((n&&n!=k)&&Interface.main.vars.made.coverwall){k=n;Interface.data.data.storage.vars.coverwallColumns=n;Interface.data.storage.save()}else{document.getElementById("coverColumnsSelect").value=k}if(Interface.utils.isNumber(k)){g="coverwall-columns-"+k}if(n!=Interface.main.vars.curCoverSort||c){d=f.length;for(j=0;j<d;j+=1){a=f[j].name;b=f[j].id;p=f[j].cover;o="";if(b==e){o="active-game"}h+='<div class="coverwall-itemcontainer '+g+'">';h+='<a href="javascript:void(0);" onclick="Interface.utils.select(\''+b+"&"+escape(a)+"')\">";h+='<div class="main-item coverwall-item '+o+'">';h+='<div class="coverwall-imagecontainer">';if(m){h+='<div class="coverwall-gametitle"><span class="coverwall-gametitletext">'+a+"</span></div>"}h+='<img class="coverwall-game" src="'+p+'" alt="Cover"/>';h+="</div></div></a></div>"}if(q&&q.length>0){$("#coverwall-container").hide();$("#coverwallSearch").show().html(h)}else{$("#coverwallSearch").hide();$("#coverwall-container").show().html(h)}Interface.main.vars.made.coverwall=true;Interface.main.vars.curCoverSort=n}},gamelist:function(c,s){var o=document.getElementById("listSortSelect").value,h=[],n=true,a,b,r,p,e,q,d,m,j="",g=Interface.data.data.active,f,k;if((c&&s)&&s.length>0){if(s.length>0){h=Interface.utils.search(s);n=true;o="search"}else{if(s.length==0){o="alphabetic"}}}if(o=="alphabetic"){h=Interface.data.data.sorted;n=true;c=false}else{if(o=="mostplayed"){h=Interface.utils.getMostPlayed();n=false}else{if(o=="lastplayed"){h=Interface.utils.getLastPlayed();n=false}}}if(o!=Interface.main.vars.curListSort||c){f=h.length;for(k=0;k<f;k+=1){a=h[k].name;b=h[k].id;r=h[k].cover;q=Interface.data.storage.getTimesPlayed(b);d=Interface.data.storage.getLastPlayed(b);if((q==0&&d==0)&&(o=="mostplayed"||o=="lastplayed")){k+=0}else{if(n){e=a.charAt(0).toUpperCase();if(Interface.utils.isNumber(e)){e="#"}if(j.indexOf("list-divider-"+e)==-1){j+='<div class="main-item list-item-accent list-divider-'+e+'"><span class="letter-item-text">';j+=e;j+="</span></div>"}}if(d==0){d="never"}else{d=new Date(d);d=d.toLocaleDateString()}p=false;if(b==g){p=true}m={onclick:"Interface.utils.select('"+b+"&"+escape(a)+"')",alt:true,active:p,image:r,title:a,sub:"Played "+q+" times, last "+d,supportLarge:true};j+=Interface.utils.html.menuItem(m)}}if(s&&s.length>0){$("#listContent").hide();$("#listSearch").show().html(j)}else{$("#listSearch").hide();$("#listContent").show().html(j)}Interface.main.vars.made.gamelist=true;Interface.main.vars.curListSort=o}},folders:function(b){if(b.length>0&&Interface.main.vars.made.folders){Interface.navigation.navigateTo(b[1]);return}if(!Interface.main.vars.made.folders){var n,k,w,m,s,u,e,a,j,d,f=Interface.data.data.active,c=Interface.data.data.games,r=Interface.data.data.folders,g=Interface.data.data.drives,t=Interface.data.storage.settings.get("seperatehdd"),h=false,q="",v={},o=r.length,p;for(p=0;p<o;p+=1){if(p<r.length&&!h){n=escape(r[p].dir);k=r[p].par}if(p==(r.length-1)&&!h){p=0;o=g.length;h=true}if(t&&h){n=escape(g[p]);k="folders-page"}if(!document.getElementById(n+"-dir")){Interface.navigation.pages.create(n+"-dir",n);j={href:"#folders-page?"+n+"-dir",id:n+"-item",alt:true,title:unescape(n),sub:"Folder",supportLarge:true};q=Interface.utils.html.menuItem(j);if(!v[k]){v[k]=""}v[k]+=q}}o=c.length;for(p=0;p<o;p+=1){w=c[p].name;m=c[p].id;s=c[p].cover;k=c[p].parent;a=Interface.data.storage.getTimesPlayed(m);e=Interface.data.storage.getLastPlayed(m);if(e==0){e="never"}else{e=new Date(e);e=e.toLocaleDateString()}u=false;if(m==f){u=true}j={onclick:"Interface.utils.select('"+m+"&"+escape(w)+"')",alt:true,active:u,image:s,title:w,sub:"Played "+a+" times, last "+e,supportLarge:true};q=Interface.utils.html.menuItem(j);if(!v[k]){v[k]=""}v[k]+=q}for(p in v){if(v.hasOwnProperty(p)){q=v[p];if(!t&&Interface.utils.isHDD(p)){d="folders-page"}else{if(p=="folders-page"){d=p}else{d=escape(p+"-dir")}}Interface.navigation.pages.addContent(d,q)}}Interface.main.vars.made.folders=true;if(b.length>0){Interface.navigation.navigateTo(b[1])}return}},favorites:function(b){if(b.length>0&&Interface.main.vars.made.favorites){Interface.navigation.navigateTo(b[1]);return}var o,x,u,w,n,t,g,h,c,a,e,m,f=Interface.data.data.active,v=Interface.data.lists.getLists(),d="",q,p=v.length,s,r;if(p==0){m={title:"No lists yet",sub:"Go make some!"};d+=Interface.utils.html.menuItem(m)}else{for(s=0;s<p;s+=1){n=v[s].name;g=n+"-listpage";t=(v[s].desc||"List");m={href:"#favorites-page?"+g,alt:true,title:unescape(n),sub:unescape(t)};d+=Interface.utils.html.menuItem(m);h=v[s].content;q=h.length;if(!Interface.navigation.pages.exists(g)){Interface.navigation.pages.create(g,unescape(n))}c="";for(r=0;r<q;r+=1){o=h[r].id;x=unescape(h[r].name);u="covers/"+o+".jpg";a=Interface.data.storage.getTimesPlayed(o);e=Interface.data.storage.getLastPlayed(o);if(e==0){e="never"}else{e=new Date(e);e=e.toLocaleDateString()}w=false;if(o==f){w=true}m={onclick:"Interface.utils.select('"+o+"&"+escape(x)+"')",alt:true,active:w,image:u,title:x,sub:"Played "+a+" times, last "+e,supportLarge:true};c+=Interface.utils.html.menuItem(m)}Interface.navigation.pages.setContent(g,c)}}if(v.length!=0){m={href:"#favorites_list_manager-page",title:"List manager",sub:"Manage your lists",active:true,supportLarge:true};d+=Interface.utils.html.menuItem(m)}Interface.navigation.pages.setContent("favorites-page",d);Interface.main.vars.made.favorites=true;if(b.length>0){Interface.navigation.navigateTo(b[1])}},favorites_game_manager:function(g){g=g[1].split("&");var c=g[0],b=g[1],h=Interface.data.lists.getLists(c),j=h.isAvailable,a=h.isIn,e="",d=j.length,f;if(d>0){for(f=0;f<d;f+=1){e+='<option value="'+j[f].name+'">'+unescape(j[f].name)+"</option>"}$(".listsAddGameSelector").html(e);$(".listsDataAddListName").attr("value",j[0].name);$(".gameManagerAddGame").removeClass("invis")}else{$(".gameManagerAddGame").addClass("invis")}e="";d=a.length;if(d>0){for(f=0;f<d;f+=1){e+='<option value="'+a[f].name+'">'+unescape(a[f].name)+"</option>"}$(".listsRemoveGameSelector").html(e);$(".listsDataRemoveListName").attr("value",a[0].name);$(".gameManagerRemoveGame").removeClass("invis")}else{$(".gameManagerRemoveGame").addClass("invis")}$(".listsDataGameID").attr("value",c);$(".listsDataGameName").attr("value",b);$(".gameManagerGameName").html(unescape(b))},favorites_list_manager:function(){var a=Interface.data.lists.getLists(),d="",b=a.length,c;if(b>0){for(c=0;c<b;c+=1){d+='<option value="'+a[c].name+'">'+unescape(a[c].name)+"</option>"}$(".listsManagerSelector").html(d);$(".listsManagerListName").attr("value",a[0].name);$(".listManagerSelectList, .listManagerOptions").removeClass("invis");$(".listManagerNoLists").addClass("invis")}else{$(".listManagerSelectList, .listManagerOptions").addClass("invis");$(".listManagerNoLists").removeClass("invis")}},recent:function(){if(!Interface.main.vars.made.recentList){Interface.main.vars.made.recentList=true;Interface.data.lists.updateRecent();return}if(!Interface.main.vars.made.recent){var j=Interface.data.lists.getLists(),h=Interface.data.lists.indexOf("Recently Added"),b,a,m,k,g,d=Interface.data.data.active,e="",c,f;j=j[h].content;c=j.length;for(f=0;f<c;f+=1){b=j[f].id;a=j[f].name;m="covers/"+b+".jpg";k=false;if(b==d){k=true}g={onclick:"Interface.utils.select('"+b+"&"+escape(a)+"')",alt:true,active:k,image:m,title:a,sub:"Newly added",supportLarge:true};e+=Interface.utils.html.menuItem(g)}Interface.navigation.pages.setContent("recent-page",e);Interface.main.vars.made.recent=true}},about:function(){if(!Interface.main.vars.made.about){var c="",a,b;c+='<div class="main-item list-item-accent"><span class="letter-item-text">';c+="Device";c+="</span></div>";for(b=0;b<Interface.data.data.about.length;b+=1){a=Interface.data.data.about[b];c+='<div class="main-item"><span class="main-item-text item-text">';c+=a.item;c+='</span><span class="secondary-item-text item-text">';c+=a.value;c+="</span></div>"}c+='<div class="main-item list-item-accent"><span class="letter-item-text">';c+="Other";c+="</span></div>";c+='<div onclick="Interface.utils.easter();Interface.utils.messageBox.create(Interface.data.messages.changelog);" class="main-item"><span class="main-item-text item-text">Interface version</span><span class="secondary-item-text item-text">';c+=Interface.data.version;c+="</span></div>";c+='<div class="main-item"><span class="main-item-text item-text">GUID</span><span class="secondary-item-text item-text">';c+=Interface.data.data.storage.guid;c+="</span></div>";c+='<a href="http://k3yforums.com/" target="_blank"><div class="main-item"><span class="main-item-text item-text">Support</span><span class="secondary-item-text item-text">';c+="Get support for anything *K3y related here";c+="</span></div></a>";c+='<a href="http://xkeydownloads.com/stats" target="_blank"><div class="main-item"><span class="main-item-text item-text">Statistics</span><span class="secondary-item-text item-text">';c+="View the online statistics";c+="</span></div></a>";c+='<a href="https://github.com/MrWaffle/K3y-Web-Interface" target="_blank"><div class="main-item"><span class="main-item-text item-text">Source on Github</span><span class="secondary-item-text item-text">';c+="Contribute or study the inner workings of this interface";c+="</span></div></a>";Interface.navigation.pages.setContent("about-page",c);Interface.main.vars.made.about=true}},settings:function(){if(!Interface.main.vars.made.settings){var f="",d=Interface.data.storage.settings.supported,a=Interface.data.storage.settings.strings,b=d.length,e,c;for(c=0;c<b;c+=1){e={href:"#settings-page",onclick:"Interface.data.storage.settings.handle(this)",id:"setting-"+d[c],title:a[d[c]].title,sub:a[d[c]].desc};f+=Interface.utils.html.menuItem(e)}Interface.navigation.pages.setContent("settings-page",f);Interface.data.storage.settings.init();Interface.main.vars.made.settings=true}}},vars:{made:{gamelist:false,coverwall:false,folders:false,favorites:false,favorites_game_manager:false,favorites_list_manager:false,recent:false,recentList:false,about:false,settings:false},index:["gamelist","coverwall","folders","recent","about","settings"],curListSort:"",curCoverSort:""}}}());